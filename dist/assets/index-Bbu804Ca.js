var k=Object.defineProperty;var L=(e,t,s)=>t in e?k(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var d=(e,t,s)=>L(e,typeof t!="symbol"?t+"":t,s);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function s(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(o){if(o.ep)return;o.ep=!0;const n=s(o);fetch(o.href,n)}})();const y={COMMON:1,RARE:1.15,EPIC:1.35},M=[{key:"basic",name:"Counter Toaster",cost:100,rarity:y.COMMON,desc:"Reliable two‑slot toaster. Pops heat pellets at loaves.",base:{range:120,fireRate:1,damage:12,projectileSpeed:300},upgrades:[{name:"Bagel Mode",cost:60,effect:e=>e.damage+=6,tip:"+6 dmg"},{name:"Crumb Catcher",cost:80,effect:e=>e.range+=25,tip:"+25 range"},{name:"Turbo Springs",cost:110,effect:e=>e.fireRate+=.4,tip:"+0.4 firerate"}]},{key:"wide",name:"4‑Slot Toaster",cost:160,rarity:y.RARE,desc:"Wider heat, slower pop. Great coverage.",base:{range:150,fireRate:.7,damage:16,projectileSpeed:260},upgrades:[{name:"Quartz Rods",cost:90,effect:e=>e.damage+=10,tip:"+10 dmg"},{name:"Heat Shield",cost:70,effect:e=>e.range+=35,tip:"+35 range"},{name:"Dual Thermostat",cost:120,effect:e=>e.fireRate+=.35,tip:"+0.35 firerate"}]},{key:"oven",name:"Mini Oven",cost:220,rarity:y.RARE,desc:"Slow baker. Launches sizzling arcs (splash).",base:{range:170,fireRate:.5,damage:30,projectileSpeed:220,splash:40,splashDmg:14},upgrades:[{name:"Convection Fan",cost:110,effect:e=>{e.fireRate+=.25},tip:"+0.25 firerate"},{name:"Pizza Stone",cost:120,effect:e=>{e.damage+=16},tip:"+16 dmg"},{name:"Long Pan",cost:130,effect:e=>{e.range+=40},tip:"+40 range"}]},{key:"microwave",name:"Microwave",cost:260,rarity:y.EPIC,desc:"Zaps across lines instantly (pierce 2).",base:{range:190,fireRate:.8,damage:18,projectileSpeed:999,pierce:2},upgrades:[{name:"Inverter Tech",cost:140,effect:e=>e.damage+=10,tip:"+10 dmg"},{name:"Wave Guide",cost:150,effect:e=>e.range+=50,tip:"+50 range"},{name:"Auto‑Reheat",cost:180,effect:e=>e.fireRate+=.5,tip:"+0.5 firerate"}]}];function w(e){return M.find(t=>t.key===e)}const H=[{key:"heat1",name:"High‑Temp Nichrome",cost:1,desc:"+10% damage to all appliances",action:e=>{for(const t of e.state.toasters)t.damage*=1.1;e.state.global.damage*=1.1}},{key:"coil1",name:"Coil Efficiency",cost:1,desc:"+10% fire rate to all",action:e=>{for(const t of e.state.toasters)t.fireRate*=1.1;e.state.global.fireRate*=1.1}},{key:"range1",name:"Insulated Housing",cost:1,desc:"+10% range to all",action:e=>{for(const t of e.state.toasters)t.range*=1.1;e.state.global.range*=1.1}},{key:"economy",name:"Coupon Clipping",cost:2,desc:"+15% coin bounty",action:e=>{e.state.global.bounty*=1.15}},{key:"pierce",name:"Serrated Slots",cost:3,desc:"Projectiles pierce +1",action:e=>{e.state.global.pierce=(e.state.global.pierce||0)+1}}],l={bind(e){document.getElementById("sellBtn").onclick=()=>e.sellSelected(),document.getElementById("rangeToggle").onchange=t=>{e.state.showRanges=t.target.checked},document.getElementById("startBtn").onclick=()=>{e.state.betweenWaves&&e.startWave()},this.refreshCatalog(e),this.refreshTech(e),this.sync(e)},log(e){const t=document.getElementById("log"),s=t.scrollTop+t.clientHeight>=t.scrollHeight-4;t.insertAdjacentHTML("beforeend",`<div>• ${e}</div>`),s&&(t.scrollTop=t.scrollHeight)},sync(e){document.getElementById("coins").textContent=e.state.coins,document.getElementById("lives").textContent=e.state.lives,document.getElementById("wave").textContent=e.state.wave,document.getElementById("ap").textContent=e.state.ap},refreshCatalog(e){const t=document.getElementById("catalog");t.innerHTML="";for(const s of M){const a=document.createElement("div");a.className="card",a.innerHTML=`<div class="row"><b>${s.name}</b><span class="badge">${s.cost}c</span></div>
        <div class="small">${s.desc}</div>
        <button class="placeBtn btn" ${e.state.coins<s.cost?"disabled":""}>Place</button>`,a.querySelector(".placeBtn").onclick=()=>{e.state.placing=s},t.appendChild(a)}},refreshTech(e){const t=document.getElementById("tech");t.innerHTML="";for(const s of H){const a=document.createElement("div");a.className="tech",a.innerHTML=`<b>${s.name}</b><div class="small">${s.desc}</div>
      <button class="buy btn small">${`Buy (${s.cost} AP)`}</button>`,a.querySelector(".buy").onclick=()=>{if(e.state.ap<s.cost){this.log("Not enough AP. Survive more waves!");return}e.state.ap-=s.cost,this.sync(e),s.action(e),this.log(`Tech unlocked: ${s.name}`),this.refreshTech(e),this.updateInspect(e)},t.appendChild(a)}},updateInspect(e){const t=document.getElementById("inspectSection"),s=document.getElementById("inspect"),a=e.getSelected();if(!a){t.style.display="none",s.innerHTML="";return}t.style.display="block";const o=w(a.type),n=a.level<o.upgrades.length,i=n?o.upgrades[a.level]:null;s.innerHTML=`
      <div class="row"><b>${a.name}</b><span class="small">ID ${a.id}</span></div>
      <div class="keyline"></div>
      <div class="small">Range: ${a.range.toFixed(0)} | Dmg: ${a.damage.toFixed(0)} | Fire/s: ${a.fireRate.toFixed(2)}${a.pierce?` | Pierce: ${a.pierce}`:""}${a.splash?` | Splash: ${a.splash}`:""}</div>
      <div class="keyline"></div>
      ${n?`
        <div class="row"><div>Next: <b>${i.name}</b><div class="small">${i.tip}</div></div>
        <button id="upgradeBtn" class="btn small" ${e.state.coins<i.cost?"disabled":""}>Upgrade (${i.cost}c)</button></div>
      `:'<div class="small">Maxed out. Shines like new chrome.</div>'}
    `,n&&(document.getElementById("upgradeBtn").onclick=()=>{e.state.coins<i.cost||(e.state.coins-=i.cost,this.sync(e),i.effect(a),a.level++,this.float(e,a.x,a.y,"Upgrade!"),this.updateInspect(e),this.refreshCatalog(e))})},float(e,t,s,a,o=!1){e.state.texts.push({x:t,y:s,str:a,isBad:o,t:0})}};function W(e,t){return{w:e,h:t,coins:150,lives:100,wave:0,ap:0,placing:null,selected:null,showRanges:!0,running:!1,global:{damage:1,fireRate:1,range:1,bounty:1,pierce:0},waveQueue:[],spawnTimer:0,betweenWaves:!0,waveInProgress:!1,idSeq:1,toasters:[],texts:[]}}const A=36,c=[{x:-20,y:80},{x:160,y:80},{x:160,y:160},{x:320,y:160},{x:320,y:60},{x:560,y:60},{x:560,y:260},{x:420,y:260},{x:420,y:420},{x:780,y:420},{x:780,y:200},{x:980,y:200}],h={cw:30,ch:30};function j(e,t,s,a,o,n){const i=o-s,r=n-a,u=e-s,B=t-a,b=i*u+r*B;if(b<=0)return Math.hypot(e-s,t-a);const T=i*i+r*r;if(T<=b)return Math.hypot(e-o,t-n);const S=b/T,C=s+S*i,$=a+S*r;return Math.hypot(e-C,t-$)}function I(e,t){for(let s=0;s<c.length-1;s++){const a=c[s],o=c[s+1];if(j(e,t,a.x,a.y,o.x,o.y)<=A)return!0}return!1}function N(e,t){return!I(e,t)}const f=[];function O(e){const t={id:++F,type:e.type,hp:e.hp,maxHp:e.hp,speed:e.speed,bounty:e.bounty,wpt:0,x:c[0].x,y:c[0].y,r:12,alive:!0};f.push(t)}function D(e,t){for(const s of f){if(!s.alive)continue;const a=c[s.wpt+1];if(!a){s.alive=!1,t.lives-=1,document.getElementById("lives").textContent=t.lives,t.lives<=0&&(t.running=!1);continue}const o=a.x-s.x,n=a.y-s.y,i=Math.hypot(o,n);if(i<2){s.wpt++;continue}const r=o/i*s.speed,u=n/i*s.speed;s.x+=r*e,s.y+=u*e}}function R(e,t,s){if(e.hp-=t,e.hp<=0){e.alive=!1;const a=Math.round(e.bounty*s.global.bounty);s.coins+=a,document.getElementById("coins").textContent=s.coins}}let F=0;const p=[];function q(e,t){const s=Math.atan2(t.y-e.y,t.x-e.x),a=e.projectileSpeed,o={id:++z,x:e.x,y:e.y,vx:Math.cos(s)*a,vy:Math.sin(s)*a,dmg:e.damage,pierce:e.pierce||0,splash:e.splash||0,splashDmg:e.splashDmg||0,life:2};p.push(o)}function Q(e,t){for(const s of p){s.x+=s.vx*e,s.y+=s.vy*e,s.life-=e,s.life<=0&&(s.dead=!0);for(const a of f)if(a.alive&&Math.hypot(s.x-a.x,s.y-a.y)<=a.r){if(R(a,s.dmg,t),s.splash>0)for(const o of f){if(!o.alive)continue;Math.hypot(s.x-o.x,s.y-o.y)<=s.splash&&o!==a&&R(o,s.splashDmg,t)}if(s.pierce>0)s.pierce--;else{s.dead=!0;break}}}for(let s=p.length-1;s>=0;s--)p[s].dead&&p.splice(s,1)}let z=0;const g=[];function x(e){for(const t of g)t.vy+=t.g*e,t.x+=t.vx*e,t.y+=t.vy*e,t.life-=e,t.life<=0&&(t.dead=!0);for(let t=g.length-1;t>=0;t--)g[t].dead&&g.splice(t,1)}function U(e,t){const s=t.w,a=t.h;e.clearRect(0,0,s,a),e.fillStyle="#0d1017",e.fillRect(0,0,s,a);for(let o=0;o<a;o+=h.ch)for(let n=0;n<s;n+=h.cw){const i=n+h.cw/2,r=o+h.ch/2,u=I(i,r);e.fillStyle=u?"#1d2331":"#111827",e.fillRect(n,o,h.cw-1,h.ch-1)}e.strokeStyle="#2a3246",e.lineWidth=8,e.beginPath(),e.moveTo(c[0].x,c[0].y);for(let o=1;o<c.length;o++){const n=c[o];e.lineTo(n.x,n.y)}e.stroke();for(const o of f){if(!o.alive)continue;const n=o.hp/o.maxHp;e.save(),e.translate(o.x,o.y),e.fillStyle="#c58a55",m(e,-14,-10,28,20,8),e.fillStyle="#8c5a2f",m(e,-14,-12,28,8,6),e.fillStyle="#000000aa",e.fillRect(-14,-16,28,3),e.fillStyle=n>.4?"#7bd88f":"#ff6b6b",e.fillRect(-14,-16,28*n,3),e.restore()}for(const o of t.toasters)e.save(),e.translate(o.x,o.y),e.fillStyle="#9aa3b2",m(e,-16,-14,32,28,6),e.fillStyle="#cfd6e2",m(e,-14,-12,28,10,4),e.fillStyle="#2b2f3c",e.fillRect(-10,-6,8,4),e.fillRect(2,-6,8,4),e.fillStyle="#1e2230",e.beginPath(),e.arc(12,4,4,0,Math.PI*2),e.fill(),t.showRanges&&(!t.selected||t.selected===o.id)&&(e.strokeStyle="#3a445f66",e.beginPath(),e.arc(0,0,o.range,0,Math.PI*2),e.stroke()),e.restore();for(const o of p)e.fillStyle="#ffd166",e.beginPath(),e.arc(o.x,o.y,3,0,Math.PI*2),e.fill();for(const o of g)e.fillStyle="#e7c08a88",e.fillRect(o.x,o.y,2,2);for(const o of t.texts){const n=1-Math.min(1,o.t/1.2);e.globalAlpha=n,e.fillStyle=o.isBad?"#ff6b6b":"#ffd166",e.font="12px ui-monospace,Consolas",e.fillText(o.str,o.x,o.y-10-20*o.t),e.globalAlpha=1,o.t+=1/60}}function m(e,t,s,a,o,n){e.beginPath(),e.moveTo(t+n,s),e.arcTo(t+a,s,t+a,s+o,n),e.arcTo(t+a,s+o,t,s+o,n),e.arcTo(t,s+o,t,s,n),e.arcTo(t,s,t+a,s,n),e.closePath(),e.fill()}function Y(e){const t=[],s=15+Math.floor(e*1.5);for(let a=0;a<s;a++)t.push({type:"slice",hp:20+4*e,speed:70+1.5*e,bounty:4});if(e%3===0)for(let a=0;a<6+Math.floor(e/2);a++)t.push({type:"baguette",hp:80+10*e,speed:60+1.2*e,bounty:9});if(e%5===0)for(let a=0;a<3+Math.floor(e/3);a++)t.push({type:"rye",hp:180+18*e,speed:55+1.1*e,bounty:15});for(let a=t.length-1;a>0;a--){const o=Math.random()*(a+1)|0;[t[a],t[o]]=[t[o],t[a]]}return t}class _{constructor(t,s){d(this,"canvas");d(this,"ctx");d(this,"state");d(this,"mouse",{x:-999,y:-999});d(this,"last",performance.now());this.canvas=t,this.ctx=s,this.state=W(t.width,t.height)}init(){l.bind(this),this.canvas.addEventListener("mousemove",t=>{this.mouse.x=t.offsetX,this.mouse.y=t.offsetY}),this.canvas.addEventListener("mouseleave",()=>{this.mouse.x=this.mouse.y=-9999}),this.canvas.addEventListener("click",t=>{const s=t.offsetX,a=t.offsetY,o=this.state.toasters.findLast(n=>Math.hypot(s-n.x,a-n.y)<=18);if(o){this.state.selected=o.id,l.updateInspect(this);return}this.state.placing&&this.tryPlaceTower(s,a,t.shiftKey)}),l.refreshCatalog(this),l.refreshTech(this),l.log("Welcome to Toasters vs Loaves! Place toasters and press Start Wave. Earn AP to buy Tech.")}stepTime(t){const s=Math.min(.033,(t-this.last)/1e3);return this.last=t,s}tryPlaceTower(t,s,a=!1){if(!N(t,s)){l.float(this,t,s,"Not on loaf path!",!0);return}const o=this.state.placing;if(!o)return;if(this.state.coins<o.cost){l.float(this,t,s,"Not enough coins",!0);return}for(const i of this.state.toasters)if(Math.hypot(t-i.x,s-i.y)<36){l.float(this,t,s,"Too close to another toaster",!0);return}const n=this.makeToaster(o,t,s);this.state.toasters.push(n),this.state.coins-=o.cost,l.sync(this),l.log(`Placed ${o.name} for ${o.cost}c.`),l.refreshCatalog(this),a||(this.state.placing=null)}makeToaster(t,s,a){return{id:this.state.idSeq++,type:t.key,name:t.name,x:s,y:a,range:t.base.range*this.state.global.range,fireRate:t.base.fireRate*this.state.global.fireRate,damage:t.base.damage*this.state.global.damage,projectileSpeed:t.base.projectileSpeed||300,splash:t.base.splash||0,splashDmg:t.base.splashDmg||0,pierce:(t.base.pierce||0)+this.state.global.pierce,level:0,path:0,cooldown:0,sold:!1}}sellSelected(){const t=this.getSelected();if(!t)return;t.sold=!0;const s=Math.floor(.8*this.getTowerCost(t));this.state.coins+=s,l.sync(this),this.state.toasters=this.state.toasters.filter(a=>a.id!==t.id),this.state.selected=null,l.updateInspect(this),l.refreshCatalog(this),l.float(this,t.x,t.y,`+${s}c (sold)`)}getTowerCost(t){const s=w(t.type).cost;let a=0;const o=w(t.type).upgrades;for(let n=0;n<t.level;n++)a+=o[n].cost;return s+a}getSelected(){return this.state.toasters.find(t=>t.id===this.state.selected)}startWave(){this.state.waveInProgress||(this.state.wave++,l.sync(this),l.log(`Wave ${this.state.wave} begins!`),this.state.waveQueue=Y(this.state.wave),this.state.spawnTimer=0,this.state.betweenWaves=!1,this.state.waveInProgress=!0,this.state.running=!0)}update(t){if(this.state.waveInProgress&&(this.state.spawnTimer-=t,this.state.spawnTimer<=0&&this.state.waveQueue.length&&(O(this.state.waveQueue.shift()),this.state.spawnTimer=.45),!this.state.waveQueue.length&&f.every(s=>!s.alive)&&(this.state.waveInProgress=!1,this.state.betweenWaves=!0,this.state.ap+=1,this.state.coins+=50+this.state.wave*10,l.sync(this),l.log(`Wave ${this.state.wave} cleared! +AP, +coins`))),D(t,this.state),this.state.running)for(const s of this.state.toasters){s.cooldown-=t,s.cooldown<0&&(s.cooldown=0);let a=null,o=1/0;for(const n of f){if(!n.alive)continue;const i=Math.hypot(n.x-s.x,n.y-s.y);if(i<=s.range){const r=1e3-n.wpt*50+i*.1;r<o&&(o=r,a=n)}}a&&s.cooldown===0&&(q(s,a),s.cooldown=Math.max(.02,1/s.fireRate))}Q(t,this.state),x(t)}draw(){U(this.ctx,this.state)}}const P=document.getElementById("game"),G=P.getContext("2d"),v=new _(P,G);v.init();function E(e){const t=v.stepTime(e);v.update(t),v.draw(),requestAnimationFrame(E)}requestAnimationFrame(E);
